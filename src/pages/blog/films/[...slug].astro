---
import { getSortedPosts } from '@lib/astro/post'
import { paginate } from '@lib/paginate'

import { BLOG_SLUG } from '@/consts'
import BlogPostsLayout from '@/layouts/BlogPostsLayout.astro'
import { produce } from 'immer'

const ROOT = `${BLOG_SLUG}/reviews/films`

export async function getStaticPaths() {
  let posts = await getSortedPosts()

  posts = posts.filter(post =>
    post.data.sections?.some(section => section.includes('Films'))
  )

  const featuredPosts = posts.filter(post => post.data.featured)
  const otherPosts = posts.filter(post => !post.data.featured)

  const paths = paginate(otherPosts, { title: 'Films' }).map(p =>
    produce(p, draft => {
      draft.props.featuredPosts = draft.props.page === 0 ? featuredPosts : []
      draft.props.root = `${BLOG_SLUG}/reviews/films`
    })
  )

  return paths
}

const { title, pageTitle, page, pages, featuredPosts, data } = Astro.props

const description = `I'm not a fan of digital films. Streaming ushered in an era of mediocrity in cinema and TV. 
Here I look at an eclectic mix of old films that I enjoy.`
---

<BlogPostsLayout
  title={title ?? ''}
  pageTitle={pageTitle}
  description={description}
  page={page}
  pages={pages}
  featuredPosts={featuredPosts}
  posts={data}
  root={ROOT}
  showTitle={true}
  showSectionLinks={true}
/>
