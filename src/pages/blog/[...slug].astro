---
import { type CollectionEntry, getCollection } from 'astro:content'
import BlogPost from '../../layouts/BlogPost.astro'
import { render } from 'astro:content'

export async function getStaticPaths() {
  const posts = await getCollection('blog')

  return posts.map(post => ({
    // flatten slug to the last part of the path
    // e.g. /test/my-post/ becomes /my-post/
    // this is useful for SEO and readability
    params: { slug: post.id.split('/').pop() || post.id },
    props: post,
  }))
}
type Props = CollectionEntry<'blog'>

const post = Astro.props
const { slug } = Astro.params
const { Content, remarkPluginFrontmatter, headings } = await render(post)
---

<BlogPost
  {...post.data}
  slug={slug}
  minutesRead={remarkPluginFrontmatter.minutesRead}
  lastModified={remarkPluginFrontmatter.lastModified}
  headings={headings}
>
  <Content slot="content" />
</BlogPost>
