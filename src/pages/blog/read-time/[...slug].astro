---
import BlogPostsLayout from '@/layouts/BlogPostsLayout.astro'
import { getTimePostMap } from '@/lib/astro/time'
import { getTimeBaseUrl } from '@/lib/http/urls'
import { getSortedPosts, type PostWithHero } from '@lib/astro/post'
import { paginate, type AstroPage } from '@lib/paginate'
import { produce } from 'immer'

export async function getStaticPaths() {
  const allPosts = await getSortedPosts()

  const tagMap = await getTimePostMap(allPosts)

  let paths: AstroPage<PostWithHero>[] = []

  for (const [time, posts] of tagMap.entries()) {
    const page = paginate(posts, {
      slug: `${time}-min-reads`,
      title: `${time} Minute Reads`,
    }).map(p =>
      produce(p, draft => {
        draft.props.root = getTimeBaseUrl(time)
      })
    )

    paths = paths.concat(page)
  }

  return paths
}

const { title, pageTitle, page, root, pages, data } = Astro.props
---

<BlogPostsLayout
  title={title!}
  pageTitle={pageTitle}
  page={page}
  pages={pages}
  posts={data}
  root={root!}
  showTitle={true}
/>
