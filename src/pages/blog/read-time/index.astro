---
import { ThemeLink } from '@/components/link/theme-link'
import { BLOG_SLUG, READ_TIME_SLUG } from '@/consts'
import ContentLayout from '@/layouts/ContentLayout.astro'
import { getSortedPosts } from '@/lib/astro/post'
import { getTimePostMap } from '@/lib/astro/time'
import { numSort } from '@/lib/math/math'

const posts = await getSortedPosts()

// Extract tags from all posts
const tagMap = await getTimePostMap(posts)

const times = numSort([...tagMap.keys()])
---

<ContentLayout
  title="Read Time"
  description="This page lists posts by their estimated read times."
>
  <main slot="main" class="flex flex-col gap-y-8">
    <h1 class="text-2xl font-bold">Read Time</h1>
    <ul>
      {
        times.map(time => {
          const n = tagMap.get(time)?.length ?? 0
          return (
            <li>
              <ThemeLink href={`${BLOG_SLUG}/${READ_TIME_SLUG}/${time}-min/`}>
                {`${time} min read`}
              </ThemeLink>
              ({`${n} post${n !== 1 ? 's' : ''}`})
            </li>
          )
        })
      }
    </ul>
  </main>
</ContentLayout>
