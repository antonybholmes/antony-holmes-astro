---
import { ThemeLink } from '@/components/link/theme-link'
import { BLOG_SLUG } from '@/consts'
import ContentLayout from '@/layouts/ContentLayout.astro'
import { getSortedPosts } from '@/lib/astro/post'
import { getTagPostMap } from '@/lib/astro/tags'
import { getUrlFriendlyTag } from '@/lib/http/urls'

const posts = await getSortedPosts()

// Extract tags from all posts
const tagMap = getTagPostMap(posts)

//const tags = [...tagMap.keys()].sort()

const tags = [...tagMap.keys()].sort((a, b) => {
  // let d = tagMap.get(a)!.length - tagMap.get(b)!.length

  // if (d !== 0) {
  //   return d
  // }

  return a.toString().localeCompare(b.toString())
})
//.reverse()
---

<ContentLayout
  title="Tags"
  description="This page lists all tags used in the blog posts."
>
  <main slot="main" class="flex flex-col gap-y-8">
    <h1 class="text-2xl font-bold">Tags</h1>
    <ul class="grid grid-cols-2 gap-2">
      {
        tags.map(tag => {
          const n = tagMap.get(tag)?.length ?? 0
          return (
            <li class="flex flex-row items-center gap-x-2">
              <ThemeLink href={`${BLOG_SLUG}/tag/${getUrlFriendlyTag(tag)}/`}>
                {tag}
              </ThemeLink>
              <span class="border-border/50 text-foreground/50 flex h-5 min-w-5 flex-row items-center justify-center rounded-full border px-1 text-xs">
                {n.toLocaleString()}
              </span>
            </li>
          )
        })
      }
    </ul>
  </main>
</ContentLayout>
