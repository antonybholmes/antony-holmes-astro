---
import { ThemeLink } from '@/components/link/theme-link'
import ContentLayout from '@/layouts/ContentLayout.astro'

import { getCollection } from 'astro:content'

const posts = await getCollection('blog')

// Extract tags from all posts
const tagMap = new Map()

for (const post of posts) {
  if (!post.data.tags) continue
  for (const tag of post.data.tags) {
    if (!tagMap.has(tag)) tagMap.set(tag, [])
    tagMap.get(tag).push(post)
  }
}

const tags = [...tagMap.keys()].sort()
---

<ContentLayout
  title="Tags"
  description="This page lists all tags used in the blog posts."
>
  <main slot="main" class="flex flex-col gap-y-8">
    <h1 class="text-2xl font-bold">Tags</h1>
    <ul>
      {
        tags.map(tag => (
          <li>
            <ThemeLink href={`/blog/tag/${tag.toLowerCase()}/`}>
              {tag} ({tagMap.get(tag).length})
            </ThemeLink>
          </li>
        ))
      }
    </ul>
  </main>
</ContentLayout>
